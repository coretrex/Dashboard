<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Tracking</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <div class="header">
        <h1>KPI Tracking</h1>
        <p class="subtext">Review your weekly KPI performance to gain insight into how our changes are impacting the most critical goals.</p>
    </div>
    <div class="kpi-container">
        <div class="kpi-table-container">
            <table id="kpi-table" class="kpi-table">
                <thead>
                    <tr>
                        <th>KPI</th>
                        <th>Goal</th>
                        <th class="date-cell">MM/DD/YY <div class="delete-container"><button class="delete-button" onclick="deleteColumn(2)">X</button></div></th>
                        <th class="date-cell">MM/DD/YY <div class="delete-container"><button class="delete-button" onclick="deleteColumn(3)">X</button></div></th>
                        <th class="date-cell">MM/DD/YY <div class="delete-container"><button class="delete-button" onclick="deleteColumn(4)">X</button></div></th>
                        <th class="date-cell">MM/DD/YY <div class="delete-container"><button class="delete-button" onclick="deleteColumn(5)">X</button></div></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td contenteditable="true">Revenue</td>
                        <td contenteditable="true">Goal 1</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Buy Box %</td>
                        <td contenteditable="true">Goal 2</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Optimization Score</td>
                        <td contenteditable="true">Goal 3</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Page Views</td>
                        <td contenteditable="true">Goal 4</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Conversion Rate</td>
                        <td contenteditable="true">Goal 5</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Ad Revenue</td>
                        <td contenteditable="true">Goal 6</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">ACoS</td>
                        <td contenteditable="true">Goal 7</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr>
                        <td contenteditable="true">TACoS</td>
                        <td contenteditable="true">Goal 8</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="kpi-buttons">
            <button class="kpi-button" onclick="addWeekColumn()">Add Week</button>
            <button class="kpi-button" onclick="addKpiRow()">Add KPI</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeFlatpickr();
        });

        function initializeFlatpickr() {
            document.querySelectorAll(".date-cell").forEach(cell => {
                flatpickr(cell, {
                    dateFormat: "m/d/y",
                    allowInput: true,
                    clickOpens: true,
                    onChange: function(selectedDates, dateStr, instance) {
                        cell.innerText = dateStr;
                    }
                });
            });
        }

        // Function to add a new week column to the KPI table
        function addWeekColumn() {
            const table = document.getElementById('kpi-table');
            const headerRow = table.rows[0];

            // Insert new header cell after 'Goal' column
            const newHeaderCell = headerRow.insertCell(2);
            newHeaderCell.outerHTML = `<th class="date-cell">MM/DD/YY <div class="delete-container"><button class="delete-button" onclick="deleteColumn(2)">X</button></div></th>`;

            // Add a new editable cell to each row for the new week
            for (let i = 1; i < table.rows.length; i++) {
                const newRowCell = table.rows[i].insertCell(2);
                newRowCell.contentEditable = "true";
                newRowCell.innerText = ""; // Ensure the new cell is blank
            }

            updateTableWidth();
            initializeFlatpickr();
        }

        // Function to delete a column from the KPI table
        function deleteColumn(index) {
            const table = document.getElementById('kpi-table');
            const rowCount = table.rows.length;

            for (let i = 0; i < rowCount; i++) {
                table.rows[i].deleteCell(index);
            }

            updateTableWidth();
        }

        // Function to update table width and add scroll bar if necessary
        function updateTableWidth() {
            const tableContainer = document.querySelector('.kpi-table-container');
            tableContainer.style.overflowX = 'auto';
            tableContainer.scrollLeft = tableContainer.scrollWidth; // Scroll to the end when a new column is added
        }
    </script>
</body>
</html>
